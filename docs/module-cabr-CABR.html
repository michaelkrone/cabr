<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: CABR</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: CABR</h1>

    




<section>

<header>
    
        <h2>
            <span class="ancestors"><a href="module-cabr.html">cabr</a>~</span>CABR</h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    

    <h4 class="name" id="CABR"><span class="type-signature"></span>new CABR<span class="signature">(rbac, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    



<div class="description">
    Constructs a new instance of CABR.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>rbac</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last">The <a href="https://github.com/yanickrochon/rbac-a#rbac-a">RBAC-A</a> instance to use</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">The options to setup the class
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>provider</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">An RBAC-A provider which get method will be called with the current
request to determine the current user. Defaults to the provider of the passed rbac instance.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>routes</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">An object of regular expression strings mapped to a string or array of
strings. See the <a href="https://github.com/yanickrochon/rbac-a#grouped-permissions">RBAC-A Grouped permissions syntax</a>
for examples of valid permission configurations. The keys are used as regular expressions to determine if
a route configuration applies for the current request.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>userProvider</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">Provides an optional userProvider which get method will be called with the request
object.</td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="cabr.js.html">cabr.js</a>, <a href="cabr.js.html#line25">line 25</a>
    </li></ul></dd>
    

    

    

    
</dl>















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>const rbac = require('rbac-a');
const CABR = require('cabr');

// init the rbac instance ...

const routes = {
	// every route, every HTTP method needs the awesome permission
	'.*': 'awesome',

	// every route, every HTTP method needs the awesome and funky permission
	'^\/funky': ['awesome', 'funky'],

	// every route, every HEAD request needs the 'clever' and 'smart' permission
	'.*': {HEAD: ['clever', 'smart']}, // or 'clever &amp;&amp; smart'

	// ALL HTTP methods for '/pets' will be checked with the 'pets.read' permission
	'\/pets': 'pets.read',

	// Custom config for '/cats', different HTTP methods
	// will apply different permissions
	'\/pets\/cats': {GET: 'pets.read', POST: 'cats.create', DELETE: ['pets.create', 'pets.delete']},

};

// init the cabr instance
const cabr = new CABR(rbac, {routes});

// use a custom user provider
const get = (req) => Promise.resolve(req.user);
cabr = new CABR(rbac, {routes, userProvider: {get}});</code></pre>



    
    </div>

    

    

    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id="guard"><span class="type-signature"></span>guard<span class="signature">(permissions, params<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {function}</span></h4>

    



<div class="description">
    Return a middleware function checking access based on the given permissions.
The rbac check function is called with the request as req param, the response as
res param, any additional params can be feed with the params parameter.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>permissions</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last">Array of permissions that should be checked</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>params</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">Additional params to be applied to the attribute validation</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="cabr.js.html">cabr.js</a>, <a href="cabr.js.html#line151">line 151</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    A middleware function calling next if the rbac check succeeded,
calls the options unauthorizedHandler otherwise.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">function</span>


    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="registerApp"><span class="type-signature"></span>registerApp<span class="signature">(app)</span><span class="type-signature"></span></h4>

    



<div class="description">
    Register an <a href="http://expressjs.com/en/4x.html#app">express app</a>
on this CABR instance. All mapped requests will be validated with the configured
RBAC-A permissions. For all configured attributes of a request/response, the
RBAC-A attribute function will be called with request and response for attributes configured
as pre hanlders and request, respNODE_DEBUG=cabr onse and body for after filters, after all other middleware
has been called. This method must be called before any route handling middleware is
registered that modifies the response body!
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>app</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The express app to register.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="cabr.js.html">cabr.js</a>, <a href="cabr.js.html#line109">line 109</a>
    </li></ul></dd>
    

    

    

    
</dl>















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>const express = require('express');
const cabr = new CABR(...);
const app = express();

cabr.registerApp(app).use(...);

// or
const cabredApp = cabr.registerApp(express());</code></pre>



        
            

    

    <h4 class="name" id="registerRoute"><span class="type-signature"></span>registerRoute<span class="signature">(route, methods, permissions)</span><span class="type-signature"></span></h4>

    



<div class="description">
    Add a route configuration at runtime.CABR supports dynamically building the route
configuration.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>route</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">String used as a regular expression. The route the permissions should be applied to</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>methods</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;String></span>
|

<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Array of strings of HTTP method names or a single method
as a string, '*' servers as a wildcard for all HTTP methods</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>permissions</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;Array></span>
|

<span class="param-type">Array</span>
|

<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last"><a href="https://github.com/yanickrochon/rbac-a#grouped-permissions">RBAC-A Grouped permissions syntax</a>
compatible object</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="cabr.js.html">cabr.js</a>, <a href="cabr.js.html#line127">line 127</a>
    </li></ul></dd>
    

    

    

    
</dl>















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>cabr.registerRoute('/api', {GET: 'read', POST: 'create'});</code></pre>



        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-cabr.html">cabr</a></li><li><a href="module-http-methods.html">http-methods</a></li></ul><h3>Classes</h3><ul><li><a href="module-cabr-CABR.html">CABR</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Wed Sep 14 2016 11:29:05 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>